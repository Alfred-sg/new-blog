---
title: 库存管理
category:
  - 业务
  - 电商
tags:
  - 业务
  - 电商
keywords: 电商
abbrlink: ad9e7f1
date: 2020-06-18 03:00:00
updated: 2020-06-18 03:00:00
---

本文整理自《电商产品经理宝典——电商后台系统产品逻辑全解析》。

对于库存管理来说，最重要的是库存的分配与扣减逻辑。

1. 电商库存体系分为三层：销售层、调度层、仓库层。
2. 库存的变动又分为自上而下、自下而上两种。
3. 每一层库存数量的变化可总结为增加、锁定、解锁、扣减、返还等。
   1. 增加：自有仓库通过采购入库，协同仓库通过代销采购协议入库；
   2. 锁定：下单之后锁定库存。
   3. 解锁：订单取消之后释放锁定库存。
   4. 扣减：订单支付成功之后扣减库存，扣减锁定库存。
   5. 返还：退货、换货后返还库存，相当于增加库存。
   6. 异常处理：库存数据在定期校验时，如果出现异常数据，就

需要进行异常处理（自动或人工处理）

库存数据的变动都需要有相关单据依据，例如销售订单、发货单、采购入库单等。

### 库存分层

库存变动的影响因素，主要有销售订单、采购、仓间调拨、盘盈盘亏、预售、售后退货等因素。

![image.png](kc1.png)

销售层主要面对前端用户。秒杀时，活动库存决定了是否可以秒杀成功；在预售时，预售库存决定是否可下定金预定。

* 可销售库存：网站前台显示的库存，也就是可以对外售卖的库存。
* 锁定库存：用户下单锁定库存，支付后扣减库存。
* 已销售库存：统计商品已售数量。如果取消订单或售后就需要走相应的库存变动流程变动。
* 活动库存：主要是做促销活动（例如秒杀）时，分配固定数量的商品给相应的活动，这时候就需要从可销售库存中占用相应数量给活动库存。这部分库存也是走相应的锁定、扣减逻辑。
* 预售库存：这部分是虚拟库存，主要是拉动需求，例如B端订货、双11定金预售等。预售同样走相应的锁定、扣减逻辑。不同的是，预售的订单需要备货之后，再推送至调度层。

调度层相当于订单的分配中心，将订单转化为发货单，按照调度规则决定哪些SKU由哪个仓库发货。调度层的库存分为单仓、区域、总库存三个维度，区域库存指的是这些仓库只发某一区域的，例如华中地区的仓库只配送华中地区，北京就无法从华中地区的仓库发货。调度层在某些方面上和前端库存有些重叠，前端库存也会分区域和总库存，但是不同的是，调度层对应的是实物，不会存在虚拟库存，流到调度层的订单经由调度后推动至仓库发货。

* 账面库存：仓库中的实物库存，只要是未出库的都算在账面库存中。
* 可用库存：仓库中可供发货的库存。这部分库存是可供调度的库存。
* 在途库存：下了采购单但是尚未入库的库存，在途库存理论上部分是可供销售的，例如“T＋1”的在途库存，就是指1日之后就可以入库的SKU。
* 不可销售库存：仓库盘损的库存，通常是仓库中的不良品，是无法售卖的库存。这部分库存需要通过特定途径处理。
* 已用库存：在调度层已分配的库存。

仓库层的库存对应的是实物库存，出库入库盘点都会引起仓库库存的变动。

* 可用库存：发货单推至仓库后，仓库可以用于发货的库存，不包括锁定的库存。
* 锁定库存：发货单推送至仓库后锁定库存，锁定时同时去锁定库位库存。
* 已出库库存：已经确认出库的实物库存。
* 不可用库存：盘点时发现的不良品，需要报损，从可用库存转化为不可用库存。

仓库同步：

1. 自上而下，用户下单后，首先会生成订单，扣减销售层的库存；然后流转到调度层进行调度，生成发货通知单，调整调度层的库存；最后推送至仓库，WMS系统同步响应，扣减库存并进行出库。
1. 自下而上：仓库的实物入库可以算是从下到上引起的库存变动。主要有三种单据：采购入库单、退货入库单、调拨入库单。实物入库，会连锁引起仓库层、调度层、销售层的可用库存逐步增加。

### 销售库存管理

一般情况下，销售层的库存要和调度层的实物库存保持一致。但是有时候业务需求是允许超卖、做预售、不同活动独占库存、不同渠道分配库存，就会造成预售层库存与调度层实物库存不一致。

![image.png](kc2.png)

### 库存调度逻辑

许多电商企业或者大公司，库存结构比较复杂，拥有多个仓库，仓库类型也非常多（主仓、区域仓、供应商协同仓等）。在调度发货仓库时，也有各种成本、物流以及商业上的考虑因素。调度仓库的过程实际上是在各种调度规则的限制下，对库存进行调度。

![image.png](kc3.png)

库存调度影响因素有：库存时效（选择用户就近仓库）、仓库等级（区域仓存放消费频次高的SKU，区域仓没货时，从中心仓发货；销售层会按照区域库存去判断有货无货）、业务需求（供应商直发称为供应商协同仓；对这些SKU库存进行调度时，就需要在调度层直接把仓库下发给供应商订单系统）。

特别是很多有线下零售店及仓库的商家，要将线下各个零售店当成区域仓来调度，这个情况的复杂度还要增加。

![image.png](kc4.png)

同一仓库不同级别区域不能重复，设置某一级别区域范围时，其他区域级别设置过的区域选项置灰不可选。

业务场景及前提：

* 企业在不同区域都有中心仓、协同仓。不同类型仓库优先级不同。
* 同一仓库配送区域分级，分一级区域（24小时达）、二级区域（2日达）、三级区域（2日以上）（可根据物流时效设置）。同一仓库不同级别区域不能重复，对于同一仓库，配送区域等级不能重复。
* 同一省份的供应服务商，设置其配送优先级。
* 物流时效优先。

库存调度示例逻辑：

1. 在下单时，先筛选出对应订单有库存的仓库。
2. 将收货地址与这些仓库的一级配送区域匹配，若没有再去匹配二级区域，依次类推。
3. 筛选出同级区域（物流时效相同）的仓库，再根据仓库的优先级进行筛选。
4. 若仍有多个仓库（同一类型的仓库）待选，例如金华从宁波协同仓、杭州协同仓发货时效相同，再根据同级仓库之间的优先级来进行选择，最后选择仓库（例如杭州仓）。
5. 选择好仓库之后，再根据SKU优先级、运费（体积、重量）等因素来选择物流公司。后面章节会具体讲到。
6. 当订单中有多SKU时，还会根据库存调度规则进行拆单。

库存调度的过程实际上是订单分配的过程，受许多因素影响，和许多系统发生交互。

### 库存控制策略

通过需求预测、安全库存、库存控制模型避免缺货、过量存储。

需求预测有五个方面的因素必须要考虑，即数量、时间、频率、范围以及可预测性。数量是可以用精确的数字来表达，也可以为一个范围或一个概率，例如判断某种商品95％的需求位于80到120件之间。时间是指预测的时间跨度。预测按时间的不同可划分为：短期预测、中期预测和长期预测三种。频率是特定时间内满足需求的次数。范围是指需求数量的变化范围。可预测性：需求或消耗可能会与历史数据相同，也可能与历史数据有联系，也可能与历史数据毫无关系；历史消耗量与补充库存数据可以揭示未来的形式及趋势可能是随机的或无序的、周期性的或非周期性的。

* 短期预测：短期预测的方法一般包括简单平均、加权平均和指数拟合等。短期预测时间跨度最多为1年，而通常不少于3个月。
* 中期预测：中期预测的方法包括曲线和指数平滑、基数序列等。中期预测的时间跨度为2年左右。
* 长期预测：长期预测的方法一般包括简单回归等。长期预测的时间跨度通常为2年及2年以上。

对产品或服务的需求可以分为如下几种类型：稳定型需求、趋势需求、季节需求、周期性变化的需求、随机需求、自相关需求。

![稳定型需求](kc5.png)

![趋势性需求](kc6.png)

![季节性需求](kc7.png)

预测有两个基本的方法：定性预测和定量预测。定量预测方法细分为：时间序列分析方法、因果联系分析方法以及模拟方法等。

时间序列分析方法力求以历史数据为基础来预测未来。时间序列分析方法主要有简单平均法、加权平均法、简单移动平均法、指数平滑法、线性回归等方法。

与时间序列分析方法不同，因果联系分析方法通常要考虑与预测值有关的几个变量。找到相关变量，建立相应的统计模型用于需求预测。这种方法比只用历史数据作时间序列分析方法更有效。常见的因果联系分析方法是线形回归分析。可以用与最小二乘法同样的数学模型（y ＝a＋bx ）进行线形回归分析。注意此处需要预测的自变量不是时间。

#### 安全库存

将独立需求的商品的库存分为周转库存和安全库存两部分。周转库存是指保证在固定周期内正常供应的库存量，订货量可以由各种经济订货量模型确定。

安全库存是为了防止不确定性而准备的库存，安全库存可以预防预测与实际消耗之间的差异，以及期望运输时间与实际之间的差异所造成的损失，在补充周转库存时预防缺货。在低于安全库存时进行预警，开始补货动作。

安全库存一般可以用提前期需求比例法、供应天数法以及均差法三种不同的方法来确定。提前期需求比例法，将安全库存表示为一设定的时间段，用该时间乘以该段时间内平均需求量。对大多数商品来说，50％提前期的需要量一般就可以作为一个合适的库存数量。供应天数法，人为指定一段时间的供应量作为安全库存。均差法，因为安全库存是为了保证用户在采购提前期和在接收补充库存的延迟期内的无规律的需求得到满足，因此安全库存的数量取决于需求和提前期的变化。需求和提前期变化越大，则这种商品的安全库存越大。

库存控制模型要解决的问题：订货频率，订货时间点，订货量。取决于用户的不可控因素：需求，提前期。可控因素：订货量，订货时间点。库存控制的目标：服务水平最高，费用最低。

![image.png](kc8.png)

TS 到货时间；订货时间点 库存 Q 达于 RQL；安全库存 SS；缺货时间点 SO。

基本的库存模型有两种，即定量订货模型（也称Q模型）和定期订货模型（也称固定订货间隔期系统或P模型）。